<!-- app/views/histories/index.html.erb -->
<div class="container mx-auto max-w-3xl px-4 py-8">
  <!-- タイトル -->
  <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">履歴一覧</h1>

  <!-- 合計情報 -->
  <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6 shadow-sm text-center">
    <p class="text-lg font-semibold text-gray-700">
      💰 合計金額：
      <span class="text-green-700 font-bold"><%= number_to_currency(@total_amount, unit: "", precision: 0) %>円</span>
      ／ 📦 合計箱数：
      <span class="text-green-700 font-bold"><%= @total_packs %>箱</span>
    </p>
  </div>

  <!-- 戻るボタン -->
  <div class="mb-6 text-center">
    <%= link_to "← ホームに戻る", authenticated_root_path,
          class: "inline-block px-4 py-2 bg-gray-300 text-gray-800 rounded shadow hover:bg-gray-200 transition" %>
  </div>

  <!-- 並び替え＆日付フィルタ -->
  <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4 shadow-sm">
    <%= form_with url: histories_path, method: :get, data: { turbo_frame: "histories_list" }, class: "flex flex-wrap items-center gap-3 justify-center" do %>
      <!-- 並び替え -->
      <div>
        <label for="sort" class="font-bold mr-2 text-gray-700">並び替え:</label>
        <%= select_tag :sort,
          options_for_select([
            ['購入日（新しい順）', 'date_desc'],
            ['購入日（古い順）', 'date_asc'],
            ['銘柄名（A→Z）', 'name_asc'],
            ['価格（高い順）', 'price_desc'],
            ['価格（安い順）', 'price_asc']
          ], params[:sort]),
          class: "border rounded p-1",
          onchange: "this.form.requestSubmit()" %>
      </div>

      <!-- 日付フィルタ -->
      <div>
        <label class="font-bold mr-2 text-gray-700">期間指定:</label>
        <%= date_field_tag :start_date, params[:start_date], class: "border rounded p-1" %> 〜
        <%= date_field_tag :end_date, params[:end_date], class: "border rounded p-1" %>
      </div>

      <!-- ボタン -->
      <div>
        <%= submit_tag '適用', class: "ml-2 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 cursor-pointer" %>
        <%= link_to 'クリア', histories_path, class: "ml-2 bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-500 cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <!-- 📅 ショートカットボタン -->
  <div class="text-center mb-6 space-x-2">
    <% ranges = {
      "本日" => [Date.current, Date.current],
      "1週間" => [1.week.ago.to_date, Date.current],
      "今月" => [Date.current.beginning_of_month, Date.current.end_of_month],
      "先月" => [Date.current.last_month.beginning_of_month, Date.current.last_month.end_of_month]
    } %>
    <% ranges.each do |label, (start_date, end_date)| %>
      <%= link_to label,
          histories_path(start_date: start_date, end_date: end_date),
          class: "inline-block bg-gray-100 text-gray-700 border border-gray-300 px-3 py-1 rounded hover:bg-gray-200 transition" %>
    <% end %>
  </div>

  <!-- 履歴リスト -->
  <turbo-frame id="histories_list">
    <%= render "histories/list", histories: @histories, total_amount: @total_amount, total_packs: @total_packs %>
  </turbo-frame>
</div>
