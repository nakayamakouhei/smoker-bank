<!-- app/views/histories/_list.html.erb -->
<% current_query = params.to_unsafe_h.slice("sort", "start_date", "end_date", "page").compact %>

<% if histories.any? %>
  <div class="space-y-3">
    <% histories.each do |log| %>
      <% price = log.is_a?(Smoke) ? log.cigarette.price * log.packs : log.custom_cigarette.price * log.packs %>
      <% manufacturer = log.is_a?(Smoke) ? log.cigarette&.manufacturer : nil %>
      <% icon_path = if manufacturer == "加熱式"
                      "icons/electronic-cigarette.svg"
                    else
                      "icons/cigarette-smoking.svg"
                    end %>
      <div class="flex flex-col gap-3 rounded-xl border border-gray-200 bg-white p-4 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md md:flex-row md:items-center md:justify-between">
        <div class="flex items-start gap-3">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100 shadow-inner">
            <%= image_tag icon_path, alt: "履歴アイコン", class: "h-6 w-6" %>
          </div>
          <div>
            <p class="text-sm text-gray-500">
              <%= l log.bought_date, format: :long %>
            </p>
            <p class="text-lg font-semibold text-gray-800">
              <% if log.is_a?(Smoke) %>
                <%= log.cigarette.name %>
              <% else %>
                <%= log.custom_cigarette.name %>（オリジナル）
              <% end %>
            </p>
            <p class="text-sm text-gray-600">購入数：<%= log.packs %>箱</p>
          </div>
        </div>

        <div class="flex items-end justify-between gap-4 md:flex-col md:items-end">
          <div class="text-right">
            <p class="text-xs font-semibold uppercase tracking-wide text-gray-400">支払金額</p>
            <p class="text-xl font-bold text-green-600 sm:text-2xl"><%= number_to_currency(price, unit: "", precision: 0) %>円</p>
          </div>
          <% if log.is_a?(Smoke) %>
            <%= button_to "削除", smoke_path(log),
                  method: :delete,
                  params: current_query,
                  data: { turbo: false },
                  class: "inline-flex items-center gap-1 rounded-full border border-red-200 px-3 py-1 text-xs font-semibold text-red-600 transition hover:bg-red-50 cursor-pointer" %>
          <% else %>
            <%= button_to "削除", custom_cigarette_log_path(log),
                  method: :delete,
                  params: current_query,
                  data: { turbo: false },
                  class: "inline-flex items-center gap-1 rounded-full border border-red-200 px-3 py-1 text-xs font-semibold text-red-600 transition hover:bg-red-50 cursor-pointer" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- ページネーション -->
  <div class="mt-8 flex justify-center">
    <%= paginate histories %>
  </div>
<% else %>
  <div class="rounded-xl border border-dashed border-gray-300 bg-white py-16 text-center text-gray-500">
    履歴がまだありません。
  </div>
<% end %>
