<% tweet_text = "今日も #SmokerBank で喫煙記録！\n合計#{number_to_currency(@total_amount, unit: '', precision: 0)}円使ってるみたい！\nhttps://smoker-bank.onrender.com/" %>
<% tweet_url = "https://twitter.com/intent/tweet?text=#{ERB::Util.url_encode(tweet_text)}" %>

<div class="flex flex-col items-center flex-1 px-4 py-8">
  <div class="w-full max-w-md lg:max-w-5xl lg:flex lg:items-start lg:gap-6">
    <div class="w-full overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-xl lg:flex-1 lg:h-full">
    <div class="bg-gradient-to-br from-emerald-500 to-sky-500 px-6 py-6 text-left">
      <p class="text-xs font-semibold uppercase tracking-widest text-white/70">Today&apos;s Summary</p>
      <h1 class="mt-2 text-2xl font-bold text-white">あなたの喫煙データ</h1>
      <p class="mt-1 text-xs text-white/80">金額・箱数・銘柄を一目でチェックできます。</p>
    </div>

    <div class="space-y-6 px-6 py-6">
      <div class="space-y-5">
        <div class="flex items-center gap-4">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100 text-green-700 shadow-inner">
            <%= image_tag "icons/money.svg", alt: "金額アイコン", class: "h-6 w-6" %>
          </div>
          <div class="flex-1">
            <p class="text-xs font-semibold uppercase tracking-wide text-green-700">たばこに使った金額</p>
            <div class="mt-1 text-3xl font-bold text-slate-900" id="total_amount">
              <%= render "home/total_amount" %>
            </div>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-teal-100 text-teal-700 shadow-inner">
            <%= image_tag "icons/cigarettes-package.svg", alt: "箱数アイコン", class: "h-6 w-6" %>
          </div>
          <div class="flex-1">
            <p class="text-xs font-semibold uppercase tracking-wide text-teal-700">購入した箱数</p>
            <div class="mt-1 text-3xl font-bold text-slate-900" id="total_packs">
              <%= render "home/total_packs" %>
            </div>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <div class="flex h-12 w-12 items-center justify-center rounded-full bg-lime-100 text-lime-700 shadow-inner">
            <%= image_tag "icons/cigarette-smoking.svg", alt: "銘柄アイコン", class: "h-6 w-6" %>
          </div>
          <div class="flex-1">
            <p class="text-xs font-semibold uppercase tracking-wide text-lime-700">現在の銘柄</p>
          <div class="mt-1 flex flex-wrap items-center gap-2 text-2xl font-bold text-slate-900">
            <span class="max-w-[200px] truncate sm:max-w-[260px]"><%= current_user.current_cigarette&.name ||
                                       current_user.current_custom_cigarette&.name ||
                                       "未選択" %></span>
            <%= link_to "変更", select_cigarettes_path,
                  class: "rounded-full border border-emerald-500 px-4 py-1 text-xs font-semibold text-emerald-600 transition hover:bg-emerald-50 hover:text-emerald-700" %>
          </div>
          </div>
        </div>
      </div>

      <div class="lg:hidden">
        <%= render "home/count_card" %>
      </div>

      <div class="flex flex-col gap-3 lg:hidden">
        <%= link_to "買えたものリストを見る", items_path,
              class: "block w-full rounded-lg bg-emerald-600 px-4 py-3 text-center text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-emerald-500" %>
        <%= link_to "Xで共有", tweet_url,
              class: "block w-full rounded-lg bg-slate-900 px-4 py-3 text-center text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5",
              target: "_blank", rel: "noopener" %>
      </div>
    </div>
  </div>

    <div class="hidden lg:flex w-full max-w-sm flex-shrink-0 flex-col gap-6 lg:self-stretch">
      <%= render "home/count_card" %>

      <div class="flex flex-col gap-3">
        <%= link_to "買えたものリストを見る", items_path,
              class: "block w-full rounded-lg bg-emerald-600 px-4 py-3 text-center text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-emerald-500" %>
        <%= link_to "Xで共有", tweet_url,
              class: "block w-full rounded-lg bg-slate-900 px-4 py-3 text-center text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5",
              target: "_blank", rel: "noopener" %>
      </div>
    </div>
  </div>

  <%= turbo_frame_tag "monthly_overview", class: "w-full flex justify-center" do %>
    <div class="mt-6 w-full max-w-md lg:max-w-5xl overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-xl">
      <div class="bg-gradient-to-r from-sky-500 to-indigo-500 px-6 py-4 text-left">
        <p class="text-xs font-semibold uppercase tracking-widest text-white/70">Monthly Overview</p>
        <h2 class="mt-1 text-xl font-bold text-white">月ごとの出費</h2>
        <p class="mt-1 text-xs text-white/80">直近の月別出費をグラフで確認できます。</p>
      </div>
      <div class="px-6 py-6">
        <div class="mb-4 flex flex-col items-center gap-3 text-slate-700">
          <div class="flex items-center justify-center gap-4">
            <%= link_to "&lt;".html_safe, authenticated_root_path(year: @previous_year),
                  class: "inline-flex h-8 w-8 items-center justify-center rounded-full border border-slate-300 text-lg font-semibold text-slate-600 hover:bg-slate-100" %>
            <span class="text-lg font-semibold text-slate-800"><%= @selected_year %>年</span>
            <%= link_to "&gt;".html_safe, authenticated_root_path(year: @next_year),
                  class: "inline-flex h-8 w-8 items-center justify-center rounded-full border border-slate-300 text-lg font-semibold text-slate-600 hover:bg-slate-100" %>
          </div>
          <% if @selected_year != @current_year %>
            <%= link_to "今年のグラフに戻る", authenticated_root_path(year: @current_year),
                  class: "inline-flex items-center justify-center rounded-full border border-emerald-500 px-4 py-1 text-sm font-semibold text-emerald-600 transition hover:bg-emerald-50" %>
          <% end %>
        </div>
        <%= column_chart @monthly_amounts,
              height: "280px",
              colors: ["#6366f1"],
              thousands: ",",
              suffix: "円",
              library: {
                plugins: { legend: { display: false } },
                scales: {
                  y: { title: { display: true, text: "金額（円）", rotation: 270 }, ticks: { beginAtZero: true } },
                  x: { title: { display: true, text: "月" } }
                }
              }
              %>
      </div>
    </div>
  <% end %>
</div>
